# F10-2: 提示词模板管理

## 基本信息

- **Feature ID**: F10-2
- **Feature 名称**: 提示词模板管理
- **优先级**: P0（MVP 必须）
- **状态**: 待开发
- **负责人**: 待分配
- **预计工作量**: 待评估
- **父特性**: F10 - 配置和管理 Agent

## 用户故事

作为运维工程师，我希望能够管理 Agent 的提示词模板，以便快速创建和复用高质量的 Agent 配置。

## 功能价值

- 提供预设的提示词模板，降低 Agent 配置门槛
- 支持提示词的复用和共享
- 积累和沉淀最佳实践

## 核心功能

### 1. 创建提示词模板
- 填写模板基本信息（名称、描述、适用场景）
- 编写系统提示词（定义 Agent 角色和任务）
- 编写用户提示词模板（支持变量占位符）
- 配置模板变量（变量名、类型、默认值、说明）
- 保存模板

### 2. 查看提示词模板列表
- 展示所有可用模板
- 按类别过滤（巡检类、故障分析类、趋势预测类等）
- 按名称搜索
- 显示模板使用次数

### 3. 编辑提示词模板
- 修改模板基本信息
- 更新系统提示词
- 调整用户提示词
- 修改模板变量定义

### 4. 删除提示词模板
- 检查模板是否被 Agent 使用
- 验证用户权限
- 确认删除操作
- 执行删除

### 5. 使用提示词模板
- 从模板创建 Agent
- 填充模板变量
- 预览生成的提示词
- 保存为 Agent 配置

### 6. 测试提示词模板
- 使用样例数据测试模板
- 查看 LLM 响应结果
- 验证模板效果

### 7. 提示词模板分类管理
- 创建模板类别
- 为模板分配类别
- 按类别组织模板

### 8. 提示词模板版本管理
- 记录模板修改历史
- 支持回滚到历史版本
- 对比不同版本的差异

## 验收标准

### AC1: 创建提示词模板
**WHEN** 用户点击"创建模板"按钮 **THEN** THE System **SHALL** 显示模板配置表单

**WHEN** 用户填写必填信息并保存 **THEN** THE System **SHALL** 创建模板并跳转到模板详情页

### AC2: 模板变量支持
**WHEN** 用户编写提示词 **THEN** THE System **SHALL** 支持使用 {{变量名}} 语法定义变量

**WHEN** 用户定义模板变量 **THEN** THE System **SHALL** 支持字符串、数字、布尔、枚举等类型

**WHEN** 用户使用模板创建 Agent **THEN** THE System **SHALL** 提示用户填充所有必填变量

### AC3: 预设模板
**WHEN** 系统初始化 **THEN** THE System **SHALL** 提供至少 2 个预设模板：
- 巡检模板：用于资源健康状态检查
- 故障分析模板：用于故障原因分析

### AC4: 查看和管理模板
**WHEN** 用户访问模板管理页面 **THEN** THE System **SHALL** 显示所有可用模板列表

**WHEN** 用户搜索模板 **THEN** THE System **SHALL** 实时过滤并显示匹配的模板

**WHEN** 用户是模板创建者 **THEN** THE System **SHALL** 允许用户编辑和删除该模板

### AC5: 使用模板创建 Agent
**WHEN** 用户从模板创建 Agent **THEN** THE System **SHALL** 自动填充系统提示词和用户提示词

**WHEN** 模板包含变量 **THEN** THE System **SHALL** 显示变量填充界面

**WHEN** 用户填充所有变量 **THEN** THE System **SHALL** 生成最终的提示词并预览

### AC6: 测试模板
**WHEN** 用户点击"测试模板"按钮 **THEN** THE System **SHALL** 显示变量填充和样例数据输入界面

**WHEN** 用户输入测试数据并执行 **THEN** THE System **SHALL** 调用 LLM 并显示响应结果

**WHEN** 模板测试失败 **THEN** THE System **SHALL** 显示详细的错误信息

### AC7: 模板权限
**WHEN** 用户创建模板 **THEN** THE System **SHALL** 将创建者设置为模板的所有者

**WHEN** 用户不是模板所有者 **THEN** THE System **SHALL** 禁止用户编辑或删除该模板

**WHEN** 模板所有者设置模板为公开 **THEN** THE System **SHALL** 允许所有用户使用该模板

### AC8: 模板版本管理
**WHEN** 用户修改模板 **THEN** THE System **SHALL** 自动创建新版本并保留历史版本

**WHEN** 用户查看模板历史 **THEN** THE System **SHALL** 显示所有历史版本及修改时间

**WHEN** 用户回滚模板 **THEN** THE System **SHALL** 恢复到指定历史版本

## 依赖关系

### 前置依赖
- F09: 配置 LLM 服务

### 后置依赖
- F10: 配置和管理 Agent

## 技术考虑

### 提示词模板结构
- 系统提示词：定义 Agent 的角色、能力、约束
- 用户提示词：定义具体的任务和输入数据
- 模板变量：支持动态替换的占位符

### 变量语法
- 使用 {{变量名}} 语法
- 支持默认值：{{变量名:默认值}}
- 支持条件渲染：{{#if 变量名}}...{{/if}}

### 数据模型
- 提示词模板表（基本信息）
- 模板变量表（变量定义）
- 模板版本表（版本历史）
- 模板类别表

### 预设模板示例

#### 巡检模板
```
系统提示词：
你是一个专业的运维巡检助手。你的任务是分析资源的监控数据，判断资源的健康状态，并给出巡检报告。

用户提示词：
请分析以下资源的监控数据：
资源名称：{{资源名称}}
资源类型：{{资源类型}}
监控数据：{{监控数据}}

请给出：
1. 资源健康状态（健康/警告/异常）
2. 发现的问题（如果有）
3. 建议的处理措施
```

#### 故障分析模板
```
系统提示词：
你是一个专业的故障分析专家。你的任务是根据故障现象、日志和监控数据，分析故障的根本原因和影响范围。

用户提示词：
请分析以下故障：
故障描述：{{故障描述}}
发生时间：{{发生时间}}
相关日志：{{相关日志}}
监控数据：{{监控数据}}

请给出：
1. 故障根本原因
2. 影响范围
3. 解决方案
4. 预防措施
```

### 性能要求
- 模板列表查询响应时间 < 500ms
- 模板测试执行时间 < 30 秒

## 界面设计要点

### 模板列表页面
- 左侧：类别过滤器
- 中间：模板列表（卡片展示，显示名称、描述、使用次数）
- 右上角：搜索框、创建按钮

### 模板创建页面
- 步骤 1：填写基本信息
- 步骤 2：编写系统提示词
- 步骤 3：编写用户提示词（支持变量）
- 步骤 4：定义模板变量
- 步骤 5：测试模板（可选）
- 步骤 6：确认创建

### 模板详情页面
- 顶部：模板名称、类别、使用次数、操作按钮
- Tab 页：
  - 概览：基本信息、使用统计
  - 提示词：系统提示词、用户提示词
  - 变量：模板变量定义
  - 版本历史：历史版本列表
  - 使用记录：被哪些 Agent 使用
  - 测试：测试模板功能

### 模板使用界面
- 显示模板预览
- 变量填充表单
- 生成的提示词预览
- 保存为 Agent 按钮

## 测试要点

### 功能测试
- 测试创建各种类型的模板
- 测试模板变量定义和替换
- 测试从模板创建 Agent
- 测试模板测试功能

### 集成测试
- 测试模板与 LLM 服务的集成
- 测试模板与 Agent 的集成

### 版本管理测试
- 测试模板版本创建
- 测试版本回滚
- 测试版本对比

---

**创建日期**: 2024-12-06  
**最后更新**: 2024-12-06  
**文档版本**: v1.0
