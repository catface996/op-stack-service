# 需求静态评审报告

## 1. 评审概要

- **项目名称**: AIOps Service
- **评审范围**: doc/1-intent/2-features/ 目录下的功能需求文档
- **评审文档**:
  - F01-1: 用户名密码登录
  - F03: 创建和管理IT资源
  - F04: 建立资源间的拓扑关系
  - F07: 配置LLM服务
  - F08: 配置和管理Agent
- **评审时间**: 2025-12-02
- **评审结论**: ⚠️ 有条件通过（存在需要澄清和补充的问题）

---

## 2. 问题清单

| 编号 | 类型 | 风险等级 | 问题描述 | 位置 | 建议 |
|------|------|----------|----------|------|------|
| REQ-F01-1-AMB-01 | 歧义 | 中 | "连续5次输入错误密码"未定义时间窗口 | F01-1 AC2 | 明确为"在X分钟内连续5次" |
| REQ-F01-1-AMB-02 | 歧义 | 低 | "通用错误提示"内容未定义 | F01-1 AC1 | 明确具体提示内容 |
| REQ-F01-1-MIS-01 | 遗漏 | 中 | 缺少密码强度具体要求 | F01-1 核心功能2 | 定义密码长度、复杂度要求 |
| REQ-F01-1-MIS-02 | 遗漏 | 中 | 缺少登录成功后会话有效期定义 | F01-1 | 明确会话超时时间 |
| REQ-F03-AMB-01 | 歧义 | 中 | "实时过滤"响应时间未定义 | F03 AC2 | 明确为"输入后Xms内响应" |
| REQ-F03-AMB-02 | 歧义 | 低 | "必填信息"具体内容未列出 | F03 AC1 | 列出各资源类型的必填字段 |
| REQ-F03-MIS-01 | 遗漏 | 中 | 缺少分页参数定义 | F03 资源列表 | 定义每页记录数、最大页数 |
| REQ-F03-MIS-02 | 遗漏 | 低 | 缺少资源名称长度限制 | F03 | 定义最小/最大长度 |
| REQ-F03-MIS-03 | 遗漏 | 中 | 缺少删除关联资源的具体处理策略 | F03 AC4 | 明确是级联删除还是禁止删除 |
| REQ-F04-AMB-01 | 歧义 | 中 | "强依赖/弱依赖"定义不清 | F04 核心功能1 | 明确两种依赖的业务含义和处理差异 |
| REQ-F04-AMB-02 | 歧义 | 低 | "关系状态（正常/异常）"判定标准不明 | F04 核心功能2 | 明确什么情况下关系为异常 |
| REQ-F04-MIS-01 | 遗漏 | 高 | 缺少循环依赖检测机制 | F04 | 添加循环依赖检测和处理策略 |
| REQ-F04-MIS-02 | 遗漏 | 中 | 缺少批量创建关系功能 | F04 | 考虑是否需要批量操作 |
| REQ-F07-AMB-01 | 歧义 | 高 | "成本限制"的币种未定义 | F07 核心功能5 | 明确币种（美元/人民币） |
| REQ-F07-AMB-02 | 歧义 | 中 | "告警通知"的通知方式未定义 | F07 AC4 | 明确通知渠道和接收人 |
| REQ-F07-AMB-03 | 歧义 | 中 | "自动切换到备用服务"的触发条件不明 | F07 AC5 | 明确什么情况判定为"不可用" |
| REQ-F07-MIS-01 | 遗漏 | 高 | 缺少API Key轮换机制 | F07 | 添加密钥过期和轮换策略 |
| REQ-F07-MIS-02 | 遗漏 | 中 | 缺少并发调用限制定义 | F07 | 定义每秒/每分钟调用上限 |
| REQ-F08-AMB-01 | 歧义 | 中 | "样例数据"来源和格式未定义 | F08 AC6 | 明确测试数据的来源和结构 |
| REQ-F08-AMB-02 | 歧义 | 中 | "实时显示执行日志"的刷新频率未定义 | F08 AC6 | 明确日志推送间隔 |
| REQ-F08-MIS-01 | 遗漏 | 高 | 缺少Agent执行失败的处理策略 | F08 | 定义失败后的重试、告警机制 |
| REQ-F08-MIS-02 | 遗漏 | 中 | 缺少Agent版本管理机制 | F08 | 考虑配置变更的版本追踪 |
| REQ-F08-MIS-03 | 遗漏 | 中 | 缺少Agent执行结果的保留策略 | F08 | 定义历史数据保留期限 |

---

## 3. 澄清问题 [NEEDS CLARIFICATION]

### Q1: 登录失败计数时间窗口
**背景**: F01-1 AC2定义"连续5次输入错误密码"会锁定账号，但未定义时间窗口。如果用户今天输错1次，明天输错1次，这5次是否累加？

**建议选项**:
- A) 在30分钟内连续5次错误触发锁定
- B) 在24小时内累计5次错误触发锁定
- C) 不限时间窗口，累计5次即锁定，成功登录后重置

---

### Q2: 密码强度要求
**背景**: F01-1提到"密码强度要求"但未定义具体标准，这会导致开发和测试人员理解不一致。

**建议选项**:
- A) 最少8位，必须包含大小写字母和数字
- B) 最少10位，必须包含大小写字母、数字和特殊字符
- C) 最少12位，符合NIST SP 800-63B标准

---

### Q3: 资源删除关联处理策略
**背景**: F03 AC4提到删除有关联关系的资源需要确认，但未明确确认后的处理方式。

**建议选项**:
- A) 级联删除所有关联关系
- B) 禁止删除有关联关系的资源（必须先删除关联）
- C) 标记为"已删除"状态，保留关联关系（软删除）

---

### Q4: 强依赖与弱依赖的业务定义
**背景**: F04提到关系强度分为"强依赖/弱依赖"，但未定义两者的业务含义和处理差异。

**建议选项**:
- A) 强依赖：目标节点故障会导致源节点不可用；弱依赖：目标节点故障只影响部分功能
- B) 强依赖：业务关键路径；弱依赖：非关键路径
- C) 需要产品进一步定义业务规则

---

### Q5: LLM服务不可用的判定标准
**背景**: F07 AC5提到"默认服务不可用时自动切换到备用服务"，但未定义什么情况判定为不可用。

**建议选项**:
- A) 连续3次调用失败
- B) 响应时间超过30秒
- C) 返回特定错误码（如429、500、503）
- D) 以上任一条件满足

---

### Q6: Agent执行失败处理策略
**背景**: F08定义了Agent的重试策略，但未明确最终失败后的处理方式。

**建议选项**:
- A) 发送告警通知给Agent所有者
- B) 标记任务为失败状态，等待人工处理
- C) 自动创建故障工单
- D) 以上全部

---

## 4. 缺失项 [MISSING]

| 检查项 | 缺失内容 | 风险 | 建议补充 |
|--------|----------|------|----------|
| 非功能需求-并发 | 所有文档都缺少并发用户数定义 | 高 | 定义系统支持的并发用户数（如1000并发） |
| 非功能需求-可用性 | 缺少系统SLA定义 | 高 | 定义系统可用性目标（如99.9%） |
| 非功能需求-数据备份 | 缺少数据备份和恢复策略 | 中 | 定义备份频率、保留期限、RTO/RPO |
| 安全-审计日志 | 多处提到审计日志但格式未定义 | 中 | 统一定义审计日志格式和保留策略 |
| 安全-数据脱敏 | 缺少敏感数据脱敏策略 | 中 | 定义哪些数据需要脱敏及脱敏规则 |
| 国际化 | 所有文档未提及多语言支持 | 低 | 明确是否需要国际化支持 |
| 可访问性 | 缺少无障碍访问要求 | 低 | 明确是否需要符合WCAG标准 |

---

## 5. 验收标准评估

| 文档 | AC编号 | 可测试性 | 问题 | 改进建议 |
|------|--------|----------|------|----------|
| F01-1 | AC1 | ⚠️ 部分可测 | "跳转到首页"具体路径不明 | 明确首页URL或路由 |
| F01-1 | AC2 | ⚠️ 部分可测 | 时间窗口未定义 | 添加时间窗口参数 |
| F01-1 | AC3 | ✅ 可测试 | - | - |
| F03 | AC1 | ⚠️ 部分可测 | "必填信息"未列出 | 列出具体必填字段 |
| F03 | AC2 | ⚠️ 部分可测 | "实时"响应时间未定义 | 定义具体响应时间 |
| F03 | AC3 | ✅ 可测试 | - | - |
| F03 | AC4 | ⚠️ 部分可测 | 关联资源处理策略不明 | 明确处理方式 |
| F03 | AC5 | ✅ 可测试 | - | - |
| F04 | AC1-AC5 | ⚠️ 部分可测 | 强/弱依赖定义不明 | 补充业务定义 |
| F07 | AC1-AC2 | ✅ 可测试 | - | - |
| F07 | AC3 | ✅ 可测试 | - | - |
| F07 | AC4 | ⚠️ 部分可测 | 告警通知方式未定义 | 明确通知渠道 |
| F07 | AC5 | ⚠️ 部分可测 | 不可用判定标准不明 | 定义判定条件 |
| F08 | AC1-AC5 | ✅ 可测试 | - | - |
| F08 | AC6 | ⚠️ 部分可测 | 样例数据来源不明 | 定义测试数据规范 |
| F08 | AC7 | ✅ 可测试 | - | - |

---

## 6. 边界场景清单

| 场景类型 | 场景描述 | 输入 | 预期结果 | 是否已覆盖 |
|----------|----------|------|----------|------------|
| 数值边界 | 登录失败第4次（临界值-1） | 4次错误密码 | 允许继续尝试 | ⚠️ 未明确 |
| 数值边界 | 登录失败第5次（临界值） | 5次错误密码 | 锁定账号 | ✅ 已覆盖 |
| 数值边界 | 锁定30分钟后1秒 | 时间刚好到期 | 自动解锁 | ⚠️ 未明确 |
| 数值边界 | 资源数量达到10000上限 | 创建第10001个资源 | ? | ❌ 未覆盖 |
| 数值边界 | 关系数量达到50000上限 | 创建第50001条关系 | ? | ❌ 未覆盖 |
| 数值边界 | Agent超时时间设置为0 | timeout=0 | ? | ❌ 未覆盖 |
| 数值边界 | Agent超时时间设置为3601秒 | timeout=3601 | 拒绝/截断？ | ❌ 未覆盖 |
| 字符串边界 | 资源名称为空 | name="" | 拒绝 | ⚠️ 未明确 |
| 字符串边界 | 资源名称含特殊字符 | name="<script>" | ? | ❌ 未覆盖 |
| 字符串边界 | 资源描述超长 | description.length>10000 | ? | ❌ 未覆盖 |
| 状态边界 | 已锁定账号尝试登录 | 锁定期间登录 | 提示锁定 | ✅ 已覆盖 |
| 状态边界 | 已禁用LLM服务调用 | 调用禁用的服务 | ? | ❌ 未覆盖 |
| 状态边界 | 删除正在执行任务的Agent | 删除运行中Agent | ? | ❌ 未覆盖 |
| 并发边界 | 同时修改同一资源 | 两人同时编辑 | ? | ❌ 未覆盖 |
| 并发边界 | 同时删除同一关系 | 两人同时删除 | ? | ❌ 未覆盖 |
| 时间边界 | LLM调用跨日（成本统计） | 23:59:59调用 | 计入当日还是次日 | ❌ 未覆盖 |

---

## 7. 逻辑一致性问题

### 7.1 依赖关系冲突

| 问题编号 | 问题描述 | 涉及文档 | 建议 |
|----------|----------|----------|------|
| REQ-DEP-CON-01 | F03依赖F10和F11，但F10/F11未在评审文档中定义 | F03 | 确认F10/F11的实际编号 |
| REQ-DEP-CON-02 | F04依赖F01，但F01在当前命名中是"用户登录" | F04 | 统一Feature编号命名 |
| REQ-DEP-CON-03 | F08依赖F09，但F09是"配置LLM服务"而文档中是F07 | F08 | 修正依赖关系编号 |

### 7.2 Feature编号不一致

当前文档存在Feature编号混乱问题：
- 文档文件名使用 F01-F29 编号
- 文档内容中引用的依赖关系使用不同编号体系
- 建议：统一Feature编号，建立编号映射表

---

## 8. 测试要点

### 高优先级测试点

- [ ] 登录失败锁定机制的时间窗口验证
- [ ] 密码加密存储和验证（BCrypt）
- [ ] 资源权限控制（Owner vs Viewer）
- [ ] 关系创建的权限验证
- [ ] LLM服务的成本限制功能
- [ ] LLM服务的自动切换功能
- [ ] Agent执行的超时控制
- [ ] Agent测试功能的数据隔离

### 中优先级测试点

- [ ] 资源列表的搜索和过滤性能
- [ ] 关系图遍历性能
- [ ] 并发编辑的冲突处理
- [ ] 审计日志的完整性

### 安全测试点

- [ ] SQL注入防护
- [ ] XSS防护
- [ ] CSRF防护
- [ ] API Key加密存储
- [ ] 时序攻击防护

---

## 9. 总体评估

### 9.1 文档质量评分

| 评估维度 | 得分 | 说明 |
|----------|------|------|
| 功能描述完整性 | 7/10 | 核心功能描述清晰，但边界场景覆盖不足 |
| 验收标准质量 | 6/10 | 使用GWT格式，但部分不可度量 |
| 非功能需求 | 5/10 | 部分定义了性能指标，但缺少可用性、安全性详细要求 |
| 边界条件定义 | 4/10 | 大部分边界场景未定义 |
| 异常处理定义 | 5/10 | 部分异常场景有定义，但不完整 |
| 术语一致性 | 6/10 | Feature编号存在混乱 |

### 9.2 改进建议优先级

1. **高优先级**
   - 修正Feature编号不一致问题
   - 补充密码强度和登录锁定时间窗口定义
   - 定义LLM服务不可用判定标准
   - 添加循环依赖检测机制
   - 定义Agent执行失败处理策略

2. **中优先级**
   - 补充所有边界场景定义
   - 统一非功能需求格式和指标
   - 完善并发场景处理策略
   - 添加数据备份和恢复策略

3. **低优先级**
   - 考虑国际化支持
   - 考虑无障碍访问要求
   - 优化文档结构和交叉引用

---

## 10. Gate Check 验证清单

- [x] 所有歧义词汇已标记并生成澄清问题
- [x] 功能描述包含明确的用户角色和目标
- [ ] 每个功能点都有可测试的验收标准 ⚠️ 部分不可测
- [ ] 异常场景处理已定义 ⚠️ 不完整
- [ ] 边界条件已识别并记录 ⚠️ 大部分未覆盖
- [ ] 非功能需求有具体指标 ⚠️ 部分缺失
- [x] 问题清单按风险等级排序
- [x] 所有问题使用标准编号 REQ-[ID]-[TYPE]-[NO]

---

**报告生成时间**: 2025-12-02
**评审人**: AI静态评审助手
**评审版本**: v1.0
