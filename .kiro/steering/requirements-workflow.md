# 需求分析工作流程指南

**版本**: v1.0.0
**创建日期**: 2025-01-21
**目标用户**: 需求分析师、产品经理、开发团队

---

## 📋 概览

需求分析是软件开发的起点，质量直接决定最终交付物的质量。本指南定义了一个**三阶段渐进式**需求分析流程，确保需求的完整性、准确性和可实现性。

**关键原则**: 切勿一次性完成所有阶段。通过多次自检和双向验证来确保质量。

---

## 🎯 三阶段工作流程

```
┌─────────────────────────────────────────────────────────────┐
│  阶段 1: 需求理解和澄清                                        │
│  ↓ (准出: 无遗漏、无歧义、无假设)                              │
│  阶段 2: 需求文档编写                                          │
│  ↓ (准出: EARS语法、完整验收标准、质量>=70分)                  │
│  阶段 3: 需求验证                                              │
│  ↓ (准出: 质量>=90分、用户确认)                                │
│  ✓ 进入设计阶段                                                │
└─────────────────────────────────────────────────────────────┘
```

---

## 📍 阶段 1: 需求理解和澄清

### 🎯 阶段目标

将用户的原始想法系统化地分析、质疑和澄清，确保对需求的理解准确无误，为后续文档编写奠定坚实基础。

### 📚 使用文档

```
.kiro/steering/requirements/phase1-understanding.md
```

### 🔑 核心活动

1. **准备原始需求文档**
   - 收集用户的原始需求描述
   - 整理项目背景和业务目标
   - 识别关键干系人和用户角色

2. **初步理解和识别模糊点**
   - 阅读并总结核心需求
   - 识别模糊、歧义的表述
   - 列出缺失的关键信息

3. **系统化提问和澄清**
   - 使用 5W2H 方法提问
   - 确认边界条件和异常场景
   - 澄清非功能性需求

4. **补充和确认信息**
   - 记录用户的回答
   - 更新原始需求文档
   - 确认所有疑问都已解答

### ✅ 准出标准 (Exit Criteria)

**必须满足以下所有条件才能进入阶段 2:**

- [ ] **无遗漏**: 所有功能点都已明确，包括隐含需求
- [ ] **无歧义**: 所有模糊点都已澄清，有明确的答案
- [ ] **无假设**: 关键假设都已与用户确认，不依赖猜测
- [ ] **量化指标**: 性能、安全等非功能性需求有具体数值
- [ ] **边界明确**: 系统范围、用户角色、权限边界清晰
- [ ] **用户确认**: 用户已确认理解正确，可以开始编写文档

### 🤖 与大模型协作

**在此阶段，向大模型提供**:
- 原始需求文档
- `phase1-understanding.md` 文档

**提示词模板**:
```
我正在进行需求分析的【阶段1：需求理解和澄清】。

请参考附件的最佳实践文档，帮我：
1. 总结核心需求（3-5句话）
2. 识别所有模糊点和歧义
3. 列出缺失的关键信息
4. 提出需要与用户确认的问题（按优先级排序）

请不要直接生成需求文档，只做分析和提问。

原始需求：
[粘贴原始需求内容]
```

---

## 📍 阶段 2: 需求文档编写

### 🎯 阶段目标

基于澄清后的需求，创建结构化、符合 EARS 语法的需求规格说明书，确保每个需求清晰、可测试、可验证。

### 📚 使用文档

```
.kiro/steering/requirements/phase2-writing.md
```

### 🔑 核心活动

1. **创建文档结构**
   - 引言和项目概述
   - 术语表
   - 用户角色定义

2. **编写功能需求**
   - 使用 EARS 语法编写每个需求
   - 为每个需求添加需求 ID、优先级
   - 编写验收标准（每个需求 2-5 条）

3. **编写非功能需求**
   - 性能需求（响应时间、并发量）
   - 安全需求（认证、授权、加密）
   - 可用性、可维护性、兼容性需求

4. **补充约束和依赖**
   - 技术约束
   - 业务规则
   - 外部依赖和假设

5. **添加边界场景**
   - 输入边界处理
   - 并发和竞态条件
   - 网络和系统异常
   - 权限边界

### ✅ 准出标准 (Exit Criteria)

**必须满足以下所有条件才能进入阶段 3:**

- [ ] **EARS 语法**: 100% 的需求符合 EARS 语法规范
- [ ] **验收标准**: 每个功能需求至少 2 个验收标准
- [ ] **无模糊词汇**: 不包含"快速"、"适当"、"尽可能"等模糊词
- [ ] **量化指标**: 所有性能、时间相关需求有具体数值
- [ ] **需求分类**: 所有需求已分类（FR、NFR）和优先级（MoSCoW）
- [ ] **术语一致**: 使用术语表中定义的术语，无不一致
- [ ] **边界场景**: 考虑了输入边界、异常处理、并发场景
- [ ] **初步质量**: 质量评分 >= 70 分（合格）

### 🤖 与大模型协作

**在此阶段，向大模型提供**:
- 澄清后的需求（阶段1输出）
- `phase2-writing.md` 文档

**提示词模板**:
```
我正在进行需求分析的【阶段2：需求文档编写】。

请参考附件的最佳实践文档和模板，创建结构化的需求规格说明书，包括：
1. 引言和术语表
2. 用户角色
3. 功能需求（使用 EARS 语法，包含需求 ID、优先级、验收标准）
4. 非功能需求
5. 约束条件和依赖

要求：
- 所有需求必须符合 EARS 语法
- 避免模糊词汇
- 使用具体的量化指标
- 考虑边界场景和异常处理
- 每个需求至少 2-3 个验收标准

澄清后的需求：
[粘贴阶段1输出的澄清需求]
```

---

## 📍 阶段 3: 需求验证

### 🎯 阶段目标

对需求文档进行多维度、多轮次的验证，确保需求的完整性、一致性、准确性和可测试性达到优秀水平，获得用户最终确认。

### 📚 使用文档

```
.kiro/steering/requirements/phase3-verification.md
```

### 🔑 核心活动

1. **完整性验证**
   - 功能覆盖率检查
   - 场景覆盖率检查（正常、异常、边界）
   - 非功能性需求完整性

2. **一致性验证**
   - 需求间一致性
   - 术语使用一致性
   - 验收标准与需求的一致性

3. **准确性验证**
   - EARS 语法符合率
   - 模糊词汇检测
   - 量化指标覆盖率

4. **可测试性验证**
   - 验收标准覆盖率
   - 验收标准充分性
   - 可自动化测试比例

5. **质量度量**
   - 使用质量评分卡打分
   - 识别低分项并改进
   - 迭代直到质量 >= 90 分

6. **用户确认**
   - 与用户确认需求理解
   - 确认优先级和范围
   - 获得正式批准

### ✅ 准出标准 (Exit Criteria)

**必须满足以下所有条件才能进入设计阶段:**

- [ ] **质量评分**: 需求质量总分 >= 90 分（优秀）
- [ ] **功能覆盖率**: >= 100%（包括隐含需求）
- [ ] **场景覆盖率**: >= 90%
- [ ] **EARS 符合率**: >= 95%
- [ ] **模糊词汇**: < 5%
- [ ] **验收标准**: 100% 需求有验收标准，平均 >= 2.5 条
- [ ] **术语一致性**: 术语不一致率 < 5%
- [ ] **无需求冲突**: 需求冲突率 = 0%
- [ ] **用户确认**: 用户已正式批准需求文档
- [ ] **风险识别**: 已识别并记录所有关键技术风险

### 🤖 与大模型协作

**在此阶段，向大模型提供**:
- 编写好的需求文档（阶段2输出）
- `phase3-verification.md` 文档

**提示词模板（多轮验证）**:

**第1轮 - 完整性验证**:
```
我正在进行需求分析的【阶段3：需求验证】。

请参考附件的验证检查清单，对需求文档进行【完整性验证】：

1. 功能覆盖度：是否遗漏任何功能点？
2. 场景覆盖度：是否覆盖了正常、异常、边界场景？
3. 角色覆盖度：每个用户角色都有对应需求吗？
4. 非功能性需求：是否明确了性能、安全、可用性等？

请列出发现的遗漏项，并说明影响。

需求文档：
[粘贴需求文档]
```

**第2轮 - 准确性验证**:
```
请对需求文档进行【准确性验证】：

1. EARS 语法：列出不符合 EARS 语法的需求
2. 模糊词汇：列出包含"快速"、"适当"等模糊词的需求
3. 量化指标：列出缺少具体数值的性能相关需求
4. 需求原子性：列出包含多个功能点的复合需求

对每个问题提供改进建议。
```

**第3轮 - 质量度量**:
```
请使用质量评分卡对需求文档进行综合评分：

计算以下指标：
- 完整性（权重30%）：功能覆盖率、场景覆盖率、NFR完整性
- 准确性（权重25%）：EARS符合率、模糊词汇密度、量化指标覆盖率
- 可测试性（权重25%）：验收标准覆盖率、平均验收标准数
- 一致性（权重15%）：术语不一致率、需求冲突率
- 可追溯性（权重5%）：追溯覆盖率

给出总分和改进建议。
```

---

## 🚦 阶段门控机制 (Stage Gate)

### 阶段 1 → 阶段 2 的检查点

**由谁检查**: 需求分析师 + 产品负责人

**检查方式**:
1. 需求分析师确认准出标准清单
2. 与产品负责人开会确认理解一致
3. 记录所有澄清的要点

**不通过则**: 继续补充澄清，不能开始编写文档

---

### 阶段 2 → 阶段 3 的检查点

**由谁检查**: 需求分析师（自检）

**检查方式**:
1. 逐项检查准出标准清单
2. 使用大模型进行初步质量检查
3. 确保 EARS 语法和验收标准完整

**不通过则**: 继续修改文档，直到满足所有准出标准

---

### 阶段 3 → 设计阶段 的检查点

**由谁检查**: 需求分析师 + 产品负责人 + 技术负责人

**检查方式**:
1. 质量评分 >= 90 分
2. 产品负责人正式批准需求
3. 技术负责人确认需求可实现、无重大技术风险

**不通过则**:
- 质量不达标：回到阶段 3 继续改进
- 需求有误：回到阶段 1 重新澄清
- 技术不可行：调整需求或增加技术预研

---

## 📊 质量指标仪表盘

在整个流程中，持续跟踪以下指标：

| 指标 | 目标值 | 当前值 | 状态 |
|-----|--------|--------|------|
| 功能覆盖率 | 100% | ___ | ⚪ |
| 场景覆盖率 | >= 90% | ___ | ⚪ |
| EARS 符合率 | >= 95% | ___ | ⚪ |
| 模糊词汇密度 | < 5% | ___ | ⚪ |
| 验收标准覆盖率 | 100% | ___ | ⚪ |
| 平均验收标准数 | >= 2.5 | ___ | ⚪ |
| 术语不一致率 | < 5% | ___ | ⚪ |
| 需求冲突率 | 0% | ___ | ⚪ |
| **质量总分** | **>= 90** | **___** | **⚪** |

**状态图例**: 🟢 达标 | 🟡 接近 | 🔴 未达标 | ⚪ 未测量

---

## 🔄 迭代和改进

### 何时需要回退到前一阶段？

**从阶段 2 回退到阶段 1**:
- 发现需求理解有误差
- 出现新的关键疑问
- 用户提出了新的需求

**从阶段 3 回退到阶段 2**:
- 质量评分 < 70 分且问题严重
- 需求结构需要大幅调整

**从阶段 3 回退到阶段 1**:
- 用户反馈理解完全错误
- 需求方向需要重大调整

### 迭代次数建议

- **阶段 1**: 2-3 轮澄清（视需求复杂度）
- **阶段 2**: 1-2 轮编写（第一轮快速完成，第二轮细化）
- **阶段 3**: 2-4 轮验证（多维度、多角度）

---

## 📁 文件结构

```
.kiro/steering/
├── requirements-workflow.md              # 本文件（主索引）
├── 01-requirements-best-practices.md     # 完整参考文档（2700行）
└── requirements/
    ├── phase1-understanding.md           # 阶段1：需求理解和澄清
    ├── phase2-writing.md                 # 阶段2：需求文档编写
    └── phase3-verification.md            # 阶段3：需求验证
```

---

## 💡 最佳实践提示

### ✅ 推荐做法

1. **严格按阶段进行**: 不要跳过阶段或合并阶段
2. **多轮渐进**: 每个阶段内部也要多轮迭代
3. **及时记录**: 澄清的信息立即更新到文档
4. **用户参与**: 阶段1和阶段3必须有用户参与
5. **质量优先**: 不满足准出标准不进入下一阶段

### ❌ 避免的错误

1. **一次性完成**: 试图一次生成完美的需求文档
2. **过度信任**: 完全依赖大模型输出，不进行验证
3. **忽略准出标准**: 质量不达标就进入下一阶段
4. **缺少用户确认**: 需求分析师自己做所有决定
5. **不记录假设**: 口头澄清但不更新文档

---

## 📚 补充文档

除了三个阶段文档外，还有以下补充文档供参考：

### 需求变更管理
**文档**: `.kiro/steering/requirements/requirements-change-management.md`

**适用场景**: 需求分析完成后，需要变更需求时

**主要内容**:
- 变更请求记录和影响分析
- 决策和审批流程
- 版本控制和追溯管理
- 变更的时间成本分析

### 风险与假设管理
**文档**: `.kiro/steering/requirements/requirements-risk-management.md`

**适用场景**: 需求分析阶段及整个项目生命周期

**主要内容**:
- 技术风险识别和评估
- 假设条件记录和验证
- 依赖项管理
- 风险应对策略

---

## 📞 需要帮助？

如果在任何阶段遇到困难：

1. **参考阶段文档**: 查看对应阶段的详细文档
2. **查看案例**: 每个阶段文档中都有博客评论系统的案例
3. **使用检查清单**: 每个阶段文档中都有详细的检查清单
4. **咨询大模型**: 使用阶段对应的文档和提示词模板
5. **参考补充文档**: 需要时查看变更管理和风险管理文档

---

## 📈 投资回报

**时间投入**:
- 阶段 1: 30-60 分钟
- 阶段 2: 30-60 分钟
- 阶段 3: 30-60 分钟
- **总计**: 1.5-3 小时

**节省的成本**:
- 设计阶段返工: 3-5 小时
- 开发阶段返工: 10-20 小时
- 测试阶段返工: 5-10 小时

**ROI**: 需求阶段多花 2 小时，节省后续 18-35 小时 → **9-17倍回报**

---

**记住**: 需求是整个开发流程的起点，需求的质量直接决定了最终交付物的质量。遵循此三阶段流程，确保每个阶段的准出标准都得到满足，可以显著提高项目成功率。
