# 阶段 3: 需求验证

**阶段目标**: 对需求文档进行多维度、多轮次的验证，确保需求质量达到优秀水平

**预计时间**: 30-60 分钟

**参与角色**: 需求分析师、产品负责人、技术负责人

---

## 📋 本阶段概览

需求验证是确保需求质量的关键环节。通过系统化、多维度的验证，可以及早发现问题，避免将错误传递到后续阶段。

**关键原则**:
- **多轮验证**: 从不同维度多次验证，而非一次完成
- **使用工具**: 利用大模型进行自动化检查
- **量化评估**: 使用质量评分卡客观衡量
- **持续改进**: 发现问题立即修正，再次验证

---

## 🎯 准出标准 (本阶段完成的标志)

完成以下所有检查项才能进入设计阶段：

- [ ] **质量评分**: 需求质量总分 >= 90 分（优秀）
- [ ] **功能覆盖率**: >= 100%（包括隐含需求）
- [ ] **场景覆盖率**: >= 90%
- [ ] **EARS 符合率**: >= 95%
- [ ] **模糊词汇**: < 5%
- [ ] **验收标准**: 100% 需求有验收标准，平均 >= 2.5 条
- [ ] **术语一致性**: 术语不一致率 < 5%
- [ ] **无需求冲突**: 需求冲突率 = 0%
- [ ] **用户确认**: 用户已正式批准需求文档
- [ ] **风险识别**: 已识别并记录所有关键技术风险

---

## 🔍 验证维度

### 1. 完整性验证

**目标**: 确保需求覆盖了所有必要的功能和场景

#### 完整性验证提示词

```
请对需求文档进行【完整性验证】，重点关注：

1. **功能覆盖度**：
   - 对比原始需求文档，检查是否遗漏任何功能点
   - 列出原始需求中的每个功能，标注是否已在需求文档中体现

2. **场景覆盖度**：
   - 检查是否覆盖了正常场景、异常场景、边界场景
   - 对每个功能，思考"如果...会怎样"的场景

3. **角色覆盖度**：
   - 检查是否为每个用户角色都定义了相应的需求
   - 是否遗漏了某些角色的特殊需求

4. **非功能性需求**：
   - 是否明确了性能、安全、可用性、可维护性要求
   - 是否有具体的量化指标

请列出发现的遗漏项，并说明这些遗漏可能造成的影响。

需求文档：
[粘贴需求文档]
```

#### 完整性检查清单

**功能完整性**:
- [ ] 所有原始需求都已转化为需求文档
- [ ] 识别并补充了隐含需求
- [ ] 每个用户角色都有对应的需求

**场景完整性**:
- [ ] 正常场景（Happy Path）
- [ ] 异常场景（Error Path）
- [ ] 边界场景（Edge Cases）

**非功能性需求完整性**:
- [ ] 性能需求（响应时间、吞吐量）
- [ ] 安全需求（认证、授权、加密）
- [ ] 可用性需求（可用性百分比、恢复时间）
- [ ] 可维护性需求（日志、监控）
- [ ] 兼容性需求（浏览器、设备）

---

### 2. 一致性验证

**目标**: 确保需求之间、术语使用无冲突

#### 一致性验证提示词

```
请对需求文档进行【一致性验证】，重点关注：

1. **需求间一致性**：
   - 检查需求之间是否存在矛盾或冲突
   - 特别关注不同功能模块之间的交互

2. **术语一致性**：
   - 检查同一概念在不同地方的表述是否一致
   - 检查术语表中的定义是否在需求中被正确使用

3. **与原始需求的一致性**：
   - 对比原始需求文档，检查理解是否准确
   - 是否有对原始需求的曲解或过度解读

4. **验收标准与需求的一致性**：
   - 验收标准是否真正验证了需求的核心价值
   - 是否有验收标准覆盖不到的需求点

请列出发现的不一致之处，并提供修正建议。

需求文档：
[粘贴需求文档]
```

#### 一致性检查清单

**需求冲突检查**:
- [ ] 无互相矛盾的需求
- [ ] 优先级设置合理（高优先级需求的依赖也是高优先级）
- [ ] 无循环依赖

**术语一致性**:
- [ ] 同一概念使用统一术语
- [ ] 术语表中的定义在文档中正确使用
- [ ] 无同义词混用

---

### 3. 准确性验证

**目标**: 确保需求表述清晰、无歧义、可测试

#### 准确性验证提示词

```
请对需求文档进行【准确性验证】，重点关注：

1. **语义清晰度**：
   - 检查是否存在模糊、歧义的表述
   - 列出所有模糊词汇（如"快速"、"适当"、"尽可能"）

2. **EARS 语法规范**：
   - 检查每个需求是否符合 EARS 语法
   - 检查条件、触发、响应是否明确

3. **可测试性**：
   - 每个验收标准是否可以被明确测试
   - 是否缺少具体的量化指标

4. **边界条件**：
   - 检查是否明确定义了边界值、极端情况
   - 是否考虑了输入验证、错误处理

请列出所有不够准确的需求，并提供改进建议。

需求文档：
[粘贴需求文档]
```

#### 准确性检查清单

**EARS 语法**:
- [ ] 所有需求使用 THE System SHALL 格式
- [ ] 条件需求使用 IF...THEN
- [ ] 事件驱动需求使用 WHEN...THEN
- [ ] 状态驱动需求使用 WHILE

**模糊词汇检测**:
- [ ] 无"快速"、"慢速"、"高效"
- [ ] 无"适当"、"合理"、"足够"
- [ ] 无"尽可能"、"尽量"、"大约"

**量化指标**:
- [ ] 性能需求有具体秒数
- [ ] 数据限制有具体数值
- [ ] 百分比需求有具体数字

---

### 4. 可测试性验证

**目标**: 确保每个需求都可以被验证和测试

#### 可测试性验证提示词

```
请对需求文档进行【可测试性验证】：

1. **验收标准覆盖**：
   - 每个需求是否都有验收标准？
   - 验收标准数量是否充分（至少 2 个）？

2. **验收标准质量**：
   - 验收标准是否具体、可测试？
   - 是否包含明确的输入和预期输出？

3. **边界场景**：
   - 是否考虑了输入边界（最小值、最大值、特殊值）？
   - 是否考虑了异常情况的验收标准？

4. **可自动化程度**：
   - 哪些需求可以编写自动化测试？
   - 哪些需求只能手工测试？

请列出可测试性不足的需求，并建议补充的验收标准。

需求文档：
[粘贴需求文档]
```

#### 可测试性检查清单

**验收标准**:
- [ ] 100% 需求有验收标准
- [ ] 平均每个需求 >= 2.5 个验收标准
- [ ] 验收标准具体、可验证

**边界场景**:
- [ ] 考虑了输入边界
- [ ] 考虑了异常场景
- [ ] 考虑了并发场景

---

### 5. 边界场景验证

**目标**: 确保考虑了所有边界条件和异常情况

#### 边界场景验证提示词

```
请对需求文档进行【边界场景验证】，对每个功能需求思考：

1. **输入边界**：
   - 最小值、最大值、空值、null、undefined
   - 特殊字符、超长字符串、格式错误

2. **并发场景**：
   - 多用户同时操作同一资源
   - 竞态条件、锁机制

3. **网络异常**：
   - 请求超时、网络中断、重试机制
   - 部分成功、部分失败的处理

4. **权限边界**：
   - 未登录、未授权、越权操作
   - Token 过期、会话失效

5. **数据异常**：
   - 数据库连接失败、事务回滚
   - 数据不一致、脏数据

6. **时间边界**：
   - 时区问题、夏令时、闰秒
   - 时间戳溢出、日期格式

请列出每个功能需求缺失的边界场景，并建议补充的验收标准。

需求文档：
[粘贴需求文档]
```

---

### 6. 综合验证

**目标**: 从批判性思维角度全面审查需求

#### 综合验证提示词

```
请以批判性思维审查这份需求文档，假设你是一位经验丰富的架构师和测试专家：

1. **挑战假设**：
   - 哪些需求基于未验证的假设？
   - 哪些假设如果不成立，会导致需求失效？

2. **发现隐含需求**：
   - 哪些需求虽然没有明说，但实际上是必需的？
   - 例如：需要登录功能，就隐含了密码重置、会话管理等

3. **识别依赖关系**：
   - 哪些需求依赖于其他需求先实现？
   - 是否有循环依赖？

4. **评估实现难度**：
   - 哪些需求技术复杂度高，可能需要分阶段实现？
   - 哪些需求看似简单，但实际有隐藏的复杂性？

5. **用户体验一致性**：
   - 从用户旅程的角度，是否有体验断层？
   - 是否有违反常见交互习惯的设计？

请提供你的专业见解，以及需要与用户讨论的关键决策点。

需求文档：
[粘贴需求文档]
```

---

## 📊 需求质量度量

### 质量评分卡

使用以下评分卡对需求文档进行综合评估：

| 度量维度 | 权重 | 指标 | 目标值 | 实际值 | 得分 | 加权得分 |
|---------|------|-----|--------|--------|------|---------|
| **完整性** | 30% | 功能覆盖率 | 100% | ___ | ___ | ___ |
|  |  | 场景覆盖率 | 90% | ___ | ___ | ___ |
|  |  | NFR 完整性 | 80% | ___ | ___ | ___ |
| **准确性** | 25% | EARS 符合率 | 95% | ___ | ___ | ___ |
|  |  | 模糊词汇密度 | <5% | ___ | ___ | ___ |
|  |  | 量化指标覆盖率 | 90% | ___ | ___ | ___ |
| **可测试性** | 25% | 验收标准覆盖率 | 100% | ___ | ___ | ___ |
|  |  | 平均验收标准数 | ≥2.5 | ___ | ___ | ___ |
| **一致性** | 15% | 术语不一致率 | <5% | ___ | ___ | ___ |
|  |  | 需求冲突率 | 0% | ___ | ___ | ___ |
| **可追溯性** | 5% | 追溯覆盖率 | 100% | ___ | ___ | ___ |
| **总分** |  |  |  |  |  | ___ |

**质量等级**：
- **优秀**：总分 >= 90 分 ✅ 可进入设计阶段
- **良好**：总分 >= 80 分 ⚠️ 建议改进后再进入
- **合格**：总分 >= 70 分 ⚠️ 必须改进
- **需改进**：总分 < 70 分 ❌ 必须大幅改进

### 质量度量提示词

```
请对需求文档进行【质量度量分析】，按照以下维度提供详细报告：

## 1. 完整性分析
- 统计功能需求数量、非功能需求数量
- 列出每个功能需求覆盖的场景类型（正常/异常/边界）
- 检查是否遗漏以下非功能性需求：性能、安全、可用性、可维护性、兼容性
- 计算功能覆盖率、场景覆盖率、NFR 完整性

## 2. 准确性分析
- 统计符合 EARS 语法的需求数量和不符合的需求列表
- 识别所有包含模糊词汇的需求（快速、适当、尽可能等）
- 识别复合需求（包含"和"、"或"连接多个功能点）
- 识别缺少量化指标的需求
- 计算 EARS 符合率、模糊词汇密度、量化指标覆盖率

## 3. 可测试性分析
- 统计有验收标准的需求数量
- 计算平均每个需求的验收标准数量
- 列出缺少验收标准的需求
- 计算验收标准覆盖率、平均验收标准数

## 4. 一致性分析
- 提取所有术语，识别不一致的术语使用
- 检查需求之间是否存在冲突或矛盾
- 计算术语不一致率、需求冲突率

## 5. 综合评分
根据上述分析，计算需求质量总分，并给出改进建议。

请以结构化的方式输出分析结果，包括具体的数值、百分比和需要改进的需求列表。

需求文档：
[粘贴需求文档]
```

---

## 🔄 多轮验证策略

### 策略 1: 分维度验证（推荐）

**第 1 轮**：完整性验证
- 检查是否遗漏功能、场景、角色

**第 2 轮**：准确性验证
- 检查 EARS 语法、模糊词汇、量化指标

**第 3 轮**：边界场景验证
- 检查输入边界、异常处理、并发场景

**第 4 轮**：质量度量
- 使用评分卡综合评估

---

### 策略 2: 角色切换验证

**第 1 次**：作为需求分析师
- 检查完整性和一致性

**第 2 次**：作为软件架构师
- 检查技术可行性和架构风险

**第 3 次**：作为测试工程师
- 检查可测试性和边界场景

**第 4 次**：作为安全专家
- 检查安全漏洞和合规性

---

### 策略 3: 对抗性验证

在需求看似完善时使用，让大模型主动寻找问题。

**提示词**:
```
请你作为一位批判性的审核者，用挑剔的眼光审查这份需求文档：

你的任务是找出所有潜在问题，包括但不限于：
- 逻辑漏洞和矛盾
- 隐藏的假设和依赖
- 边界情况和极端场景
- 安全隐患
- 性能瓶颈
- 用户体验问题

请尽可能多地列出问题，即使是较小的问题也要指出。
不要担心过度挑剔，现在的目标就是找出所有潜在的问题。

需求文档：
[粘贴需求文档]
```

---

## 🛠️ 问题改进指南

### 完整性不足

**问题表现**:
- 功能覆盖率 < 100%
- 场景覆盖率 < 90%

**改进措施**:
1. 回到阶段 1 与用户确认是否遗漏
2. 系统性地为每个功能补充正常、异常、边界场景
3. 使用非功能性需求检查清单逐项确认

---

### 准确性不足

**问题表现**:
- EARS 符合率 < 95%
- 模糊词汇密度 > 5%

**改进措施**:
1. 对不符合 EARS 语法的需求进行重写
2. 搜索并替换所有模糊词汇为具体描述
3. 为所有性能、时间相关需求添加具体数值

**改进示例**:
```
❌ 改进前：系统应该快速响应用户请求并记录日志
问题：模糊词汇 + 复合需求

✅ 改进后：
REQ-001: THE System SHALL 在 2 秒内响应 95% 的用户请求
REQ-002: THE System SHALL 记录每个用户请求到日志系统
```

---

### 可测试性不足

**问题表现**:
- 验收标准覆盖率 < 100%
- 平均验收标准数 < 2.5

**改进措施**:
1. 为每个需求补充至少 2 个验收标准
2. 确保验收标准具体、可测试、可量化
3. 补充边界条件和异常处理的验收标准

---

### 一致性不足

**问题表现**:
- 术语不一致率 > 5%
- 存在需求冲突

**改进措施**:
1. 更新术语表，明确每个术语的定义
2. 统一术语使用，批量修正
3. 解决需求冲突，与用户确认正确的需求

---

## 🎓 案例参考：博客评论系统（续）

### 验证过程

#### 第 1 轮：完整性验证

**发现的问题**:
- ⚠️ 缺少错误处理场景（网络失败时的行为）
- ⚠️ 缺少并发场景（两个用户同时回复）

**改进行动**:
```markdown
### 4.7 错误处理
**REQ-FR-007**: IF 评论提交因网络错误失败 THEN THE System SHALL 提示"网络错误，请重试"并保留用户输入的内容

### 4.8 并发控制
**REQ-FR-008**: WHEN 两个用户同时回复同一评论 THEN THE System SHALL 允许两个回复同时存在，按提交时间排序
```

---

#### 第 2 轮：准确性验证

**验证结果**:
- ✅ 所有需求符合 EARS 语法
- ✅ 没有模糊词汇
- ✅ 性能指标具体明确

---

#### 第 3 轮：边界场景验证

**发现的问题**:
- ⚠️ 未明确 Unicode 字符和 Emoji 的处理
- ⚠️ 未考虑评论数为 0 的情况

**改进行动**:
```markdown
REQ-FR-001 补充验收标准：
6. THE System SHALL 支持 Unicode 字符和 Emoji，计入字符总数

REQ-FR-005 补充验收标准：
6. IF 文章没有任何评论 THEN THE System SHALL 显示"暂无评论，快来发表第一条评论吧"
```

---

#### 质量度量结果

| 度量维度 | 权重 | 实际值 | 加权得分 |
|---------|------|--------|---------|
| 完整性 | 30% | 98% | 29.4 |
| 准确性 | 25% | 100% | 25 |
| 可测试性 | 25% | 100% | 25 |
| 一致性 | 15% | 100% | 15 |
| 可追溯性 | 5% | 100% | 5 |
| **总分** |  |  | **99.4** |

**质量等级**: 优秀 ✅

---

## 📋 阶段完成检查清单

### 验证完整性

- [ ] 已进行至少 3 轮不同维度的验证
- [ ] 完整性验证已完成
- [ ] 一致性验证已完成
- [ ] 准确性验证已完成
- [ ] 可测试性验证已完成
- [ ] 边界场景验证已完成

### 质量度量

- [ ] 已使用质量评分卡打分
- [ ] 质量总分 >= 90 分
- [ ] 所有低于目标的指标都已改进
- [ ] 改进后再次验证达标

### 问题修正

- [ ] 所有发现的问题都已记录
- [ ] 所有高优先级问题都已修正
- [ ] 修正后的需求已重新验证
- [ ] 无遗留的已知问题

### 用户确认

- [ ] 已与产品负责人确认需求
- [ ] 已与技术负责人确认可行性
- [ ] 用户已审阅并批准需求文档
- [ ] 获得正式的书面批准（邮件或签字）

### 风险评估

- [ ] 已识别所有技术风险
- [ ] 已评估风险的概率和影响
- [ ] 已制定风险应对策略
- [ ] 关键风险已与干系人沟通

---

## ⏭️ 下一步

完成本阶段所有检查项后，进入：

**设计阶段**
- 基于需求文档进行架构设计
- 创建详细设计文档
- 进行技术选型

---

## 💡 关键提示

### 验证的频率

- **最少**: 3 轮验证（完整性、准确性、质量度量）
- **推荐**: 4-5 轮验证（加上边界场景和综合验证）
- **理想**: 多次验证直到质量 >= 90 分

### 何时需要回退

**回退到阶段 2（需求文档编写）**:
- 质量评分 < 70 分且问题严重
- 需求结构需要大幅调整

**回退到阶段 1（需求理解和澄清）**:
- 用户反馈理解完全错误
- 发现重大遗漏需要重新澄清

### 验证的投资回报

**时间投入**: 30-60 分钟
**避免的返工**: 设计阶段 3-5 小时，开发阶段 10-20 小时
**ROI**: 15-40 倍回报

---

**记住**: 验证是需求分析的最后一道防线。通过系统化、多维度的验证，可以确保需求文档的质量，为后续阶段奠定坚实基础。不要为了赶进度而跳过验证环节，这样只会在后续阶段付出更大的代价。
