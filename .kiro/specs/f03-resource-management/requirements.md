# 需求规格说明书

**功能名称**: F03 - 创建和管理IT资源  
**文档版本**: v1.0  
**创建日期**: 2024-11-30  
**需求分析师**: AI Assistant  
**状态**: 已完成 ✅

---

## 引言

### 文档目的

本文档定义了F03功能的详细需求规格，使用EARS（Easy Approach to Requirements Syntax）语法编写，确保需求的准确性、完整性和可测试性。

### 范围

本文档涵盖IT资源管理的核心功能，包括资源的创建、查看、编辑、删除和状态管理。不包括资源类型动态管理（F02-1）、拓扑关系管理（F04）和Agent关联（F06）。

### 术语表

| 术语 | 定义 |
|------|------|
| **System** | AIOps Service系统 |
| **Resource** | IT资源，包括服务器、应用、数据库、接口、中间件、报表 |
| **Resource Type** | 资源类型，MVP阶段支持6种预置类型 |
| **Owner** | 资源所有者，拥有完全控制权限 |
| **Viewer** | 资源查看者，只有只读权限 |
| **Sensitive Information** | 敏感信息，包括账号、密码、密钥等 |
| **Optimistic Lock** | 乐观锁，使用version字段防止并发冲突 |
| **Audit Log** | 审计日志，记录所有重要操作 |

---

## 功能性需求

### 需求1：创建资源

**用户故事**: 作为运维工程师，我希望能够创建新的IT资源，以便将资源纳入统一管理。

#### 验收标准

**REQ-FR-001**: 资源类型选择  
**优先级**: MUST  
WHEN 用户点击"创建资源"按钮 THEN THE System SHALL 显示6种预置资源类型的选择界面

**验收标准**:
- 界面展示6种类型：基础设施、应用、数据库、接口、中间件、报表
- 每种类型显示图标、名称和描述
- 用户可以通过点击选择一种类型

**REQ-FR-002**: 资源信息填写  
**优先级**: MUST  
WHEN 用户选择资源类型并填写必填信息 THEN THE System SHALL 验证输入并创建资源

**验收标准**:
- 名称字段：必填，2-100字符，同类型下唯一
- 描述字段：可选，最多500字符
- 标签字段：可选，最多10个标签，每个标签最多20字符
- 扩展属性：根据资源类型动态渲染表单字段
- 验证失败时显示具体错误信息

**REQ-FR-003**: 自动设置Owner  
**优先级**: MUST  
WHEN 用户成功创建资源 THEN THE System SHALL 自动将创建者设置为该资源的第一个Owner

**验收标准**:
- 创建者的用户ID记录在created_by字段
- 创建者自动获得Owner权限
- 资源详情页显示创建者为Owner


**REQ-FR-004**: 敏感信息加密  
**优先级**: MUST  
WHEN 用户填写包含敏感信息的字段 THEN THE System SHALL 使用AES-256算法加密后存储到数据库

**验收标准**:
- 字段名包含"password"、"secret"、"key"关键词的自动识别为敏感字段
- 使用AES-256算法加密
- 加密后的数据存储在数据库
- 查询时自动解密（仅Owner可见）

**REQ-FR-005**: 创建成功跳转  
**优先级**: MUST  
WHEN 资源创建成功 THEN THE System SHALL 跳转到资源详情页并显示成功提示

**验收标准**:
- 创建成功后跳转到资源详情页
- 显示"资源创建成功"的提示消息
- 详情页展示所有已填写的信息

---

### 需求2：查看资源列表

**用户故事**: 作为运维工程师，我希望能够查看所有资源的列表，以便快速了解资源概况。

#### 验收标准

**REQ-FR-006**: 列表展示  
**优先级**: MUST  
WHEN 用户访问资源管理页面 THEN THE System SHALL 显示资源列表并支持分页

**验收标准**:
- 列表展示字段：名称、类型、状态、标签、创建时间、更新时间
- 默认分页大小：20条/页
- 支持分页大小选择：10/20/50/100条/页
- 默认排序：按创建时间降序
- 列表查询响应时间 < 1秒（10000资源场景）

**REQ-FR-007**: 按名称搜索  
**优先级**: MUST  
WHEN 用户在搜索框输入关键词 THEN THE System SHALL 实时过滤并显示名称匹配的资源

**验收标准**:
- 支持模糊搜索（LIKE %keyword%）
- 只搜索资源名称字段
- 输入防抖：300ms后触发搜索
- 搜索响应时间 < 500ms
- 搜索结果高亮显示匹配的关键词

**REQ-FR-008**: 按类型过滤  
**优先级**: MUST  
WHEN 用户选择资源类型过滤器 THEN THE System SHALL 只显示该类型的资源

**验收标准**:
- 类型过滤器显示6种预置类型
- 支持单选
- 过滤后列表实时更新
- 显示当前过滤条件

**REQ-FR-009**: 按标签过滤  
**优先级**: MUST  
WHEN 用户选择标签过滤器 THEN THE System SHALL 显示包含所选标签的资源

**验收标准**:
- 标签过滤器显示所有已使用的标签
- 支持多选（AND逻辑）
- 过滤后列表实时更新
- 显示当前选中的标签

**REQ-FR-010**: 列表排序  
**优先级**: MUST  
WHEN 用户点击列表表头 THEN THE System SHALL 按该字段排序

**验收标准**:
- 支持按创建时间、更新时间、名称排序
- 支持升序和降序切换
- 排序后列表实时更新
- 显示当前排序字段和方向

---

### 需求3：编辑资源信息

**用户故事**: 作为资源Owner，我希望能够编辑资源信息，以便保持资源信息的准确性。

#### 验收标准

**REQ-FR-011**: 权限检查  
**优先级**: MUST  
WHEN 用户是资源的Owner THEN THE System SHALL 允许用户编辑资源信息

**验收标准**:
- Owner可以看到"编辑"按钮
- 点击后进入编辑模式
- 所有字段可编辑

**REQ-FR-012**: 权限限制  
**优先级**: MUST  
WHEN 用户不是资源的Owner THEN THE System SHALL 禁止用户编辑资源信息

**验收标准**:
- 非Owner看不到"编辑"按钮
- 直接访问编辑URL返回403错误
- 显示"无权限编辑"的提示

**REQ-FR-013**: 乐观锁并发控制  
**优先级**: MUST  
WHEN 用户提交编辑 THEN THE System SHALL 检查version字段防止并发冲突

**验收标准**:
- 编辑时记录当前version值
- 提交时检查version是否变化
- 如果version变化，拒绝更新并提示"资源已被他人修改，请刷新后重试"
- 更新成功后version自动+1

**REQ-FR-014**: 敏感信息编辑  
**优先级**: MUST  
WHEN Owner编辑敏感信息字段 THEN THE System SHALL 重新加密后存储

**验收标准**:
- 敏感字段显示为"***"
- 修改时需要重新输入完整值
- 提交后使用AES-256重新加密
- 加密后存储到数据库

**REQ-FR-015**: 更新时间戳  
**优先级**: MUST  
WHEN 资源编辑成功 THEN THE System SHALL 更新updated_at字段和version字段

**验收标准**:
- updated_at更新为当前时间
- version字段+1
- 列表页显示最新的更新时间

---

### 需求4：删除资源

**用户故事**: 作为资源Owner，我希望能够删除不再需要的资源，以便保持系统整洁。

#### 验收标准

**REQ-FR-016**: 删除权限检查  
**优先级**: MUST  
WHEN 用户不是资源的Owner THEN THE System SHALL 禁止用户删除资源

**验收标准**:
- 非Owner看不到"删除"按钮
- 直接调用删除API返回403错误
- 显示"无权限删除"的提示

**REQ-FR-017**: 关联关系检查  
**优先级**: MUST  
WHEN 用户尝试删除资源 THEN THE System SHALL 检查资源是否有关联关系并提示

**验收标准**:
- 检查拓扑关系（依赖、被依赖）
- 检查Agent关联
- 检查任务关联
- 弹窗显示关联信息列表

**REQ-FR-018**: 删除确认  
**优先级**: MUST  
WHEN 用户确认删除 THEN THE System SHALL 要求用户输入资源名称进行二次确认

**验收标准**:
- 弹窗提示"此操作不可恢复，请输入资源名称确认"
- 用户必须输入完全匹配的资源名称
- 输入不匹配时禁用"确认删除"按钮

**REQ-FR-019**: 强制删除  
**优先级**: MUST  
WHEN 用户确认删除资源 THEN THE System SHALL 物理删除资源并记录审计日志

**验收标准**:
- 执行DELETE操作（物理删除）
- 级联删除关联的标签记录
- 记录审计日志（操作人、时间、资源信息）
- 删除成功后跳转到列表页并显示提示

**REQ-FR-020**: 审计日志记录  
**优先级**: MUST  
WHEN 资源被删除 THEN THE System SHALL 记录完整的审计日志

**验收标准**:
- 记录操作类型：DELETE
- 记录操作人ID和姓名
- 记录操作时间
- 记录被删除资源的完整信息（JSON格式）
- 审计日志保留180天

---

### 需求5：查看资源详情

**用户故事**: 作为运维工程师，我希望能够查看资源的详细信息，以便了解资源的完整配置。

#### 验收标准

**REQ-FR-021**: 详情页展示  
**优先级**: MUST  
WHEN 用户点击资源名称 THEN THE System SHALL 显示资源详情页

**验收标准**:
- 顶部显示：资源名称、类型、状态、操作按钮
- Tab页：概览、配置、拓扑、Agent、任务、权限
- 概览Tab展示所有基本信息和扩展属性
- 详情页加载时间 < 500ms

**REQ-FR-022**: 敏感信息权限控制  
**优先级**: MUST  
WHEN Owner查看资源详情 THEN THE System SHALL 允许查看敏感信息

**验收标准**:
- 敏感字段默认显示为"***"
- 提供"显示"按钮
- 点击后显示明文（解密后）
- 3秒后自动隐藏

**REQ-FR-023**: 敏感信息隐藏  
**优先级**: MUST  
WHEN Viewer查看资源详情 THEN THE System SHALL 隐藏敏感信息

**验收标准**:
- 敏感字段显示为"***"
- 不提供"显示"按钮
- 鼠标悬停提示"仅Owner可见"

**REQ-FR-024**: 状态徽章展示  
**优先级**: MUST  
WHEN 资源详情页加载 THEN THE System SHALL 以徽章形式展示资源状态

**验收标准**:
- 运行中：绿色徽章
- 已停止：灰色徽章
- 维护中：黄色徽章
- 已下线：红色徽章

**REQ-FR-025**: 操作历史展示  
**优先级**: SHOULD  
WHEN 用户查看资源详情 THEN THE System SHALL 展示最近10条操作历史

**验收标准**:
- 显示操作类型、操作人、操作时间
- 按时间倒序排列
- 支持查看更多（分页）

---

### 需求6：资源状态管理

**用户故事**: 作为资源Owner，我希望能够管理资源状态，以便反映资源的真实运行情况。

#### 验收标准

**REQ-FR-026**: 状态定义  
**优先级**: MUST  
THE System SHALL 支持4种预定义的资源状态

**验收标准**:
- 运行中（RUNNING）：资源正常运行
- 已停止（STOPPED）：资源已停止
- 维护中（MAINTENANCE）：资源正在维护
- 已下线（OFFLINE）：资源已下线

**REQ-FR-027**: 手动设置状态  
**优先级**: MUST  
WHEN Owner选择新状态 THEN THE System SHALL 更新资源状态并记录审计日志

**验收标准**:
- 详情页提供状态下拉框
- 列表页支持快速切换状态
- 状态变更立即生效
- 记录审计日志（旧状态 → 新状态）

**REQ-FR-028**: 状态变更审计  
**优先级**: MUST  
WHEN 资源状态变更 THEN THE System SHALL 记录状态变更的审计日志

**验收标准**:
- 记录操作类型：STATUS_CHANGE
- 记录旧状态和新状态
- 记录操作人和操作时间
- 审计日志可追溯

---

## 非功能性需求

### 需求7：性能要求

**REQ-NFR-001**: 列表查询性能  
**优先级**: MUST  
THE System SHALL 在10000资源场景下，列表查询响应时间小于1秒

**验收标准**:
- 后端处理时间 < 800ms
- 数据库查询时间 < 500ms
- 使用数据库索引优化
- 使用Redis缓存热点数据

**REQ-NFR-002**: 搜索性能  
**优先级**: MUST  
THE System SHALL 搜索响应时间小于500ms

**验收标准**:
- 包含网络传输时间
- 使用数据库索引（name字段）
- 搜索结果限制最多1000条

**REQ-NFR-003**: 详情页加载性能  
**优先级**: MUST  
THE System SHALL 详情页加载时间小于500ms

**验收标准**:
- 包含网络传输时间
- 使用主键查询
- 敏感信息按需解密

**REQ-NFR-004**: 创建资源性能  
**优先级**: MUST  
THE System SHALL 创建资源响应时间小于200ms

**验收标准**:
- 后端处理时间 < 200ms
- 敏感信息加密时间 < 50ms
- 数据库插入时间 < 100ms

---

### 需求8：容量要求

**REQ-NFR-005**: 资源数量支持  
**优先级**: MUST  
THE System SHALL 支持至少10000个资源的管理

**验收标准**:
- 10000资源场景下功能正常
- 列表查询性能满足要求
- 搜索功能正常工作

**REQ-NFR-006**: 并发用户支持  
**优先级**: MUST  
THE System SHALL 支持至少100个并发用户

**验收标准**:
- 100并发用户场景下功能正常
- 响应时间不超过要求的2倍
- 无数据不一致问题

**REQ-NFR-007**: 标签数量限制  
**优先级**: SHOULD  
THE System SHALL 限制每个资源最多10个标签

**验收标准**:
- 创建/编辑时验证标签数量
- 超过10个时提示错误
- 错误信息："标签数量不能超过10个"

---

### 需求9：安全要求

**REQ-NFR-008**: 敏感信息加密  
**优先级**: MUST  
THE System SHALL 使用AES-256算法加密所有敏感信息

**验收标准**:
- 使用AES-256算法
- 密钥长度256位
- 加密后数据存储在数据库
- 密钥存储在配置文件（加密）

**REQ-NFR-009**: 权限验证  
**优先级**: MUST  
THE System SHALL 在所有操作前验证用户权限

**验收标准**:
- 编辑操作：验证Owner权限
- 删除操作：验证Owner权限
- 查看敏感信息：验证Owner权限
- 权限验证失败返回403错误

**REQ-NFR-010**: 审计日志完整性  
**优先级**: MUST  
THE System SHALL 记录所有重要操作的审计日志

**验收标准**:
- 记录CREATE、UPDATE、DELETE、STATUS_CHANGE操作
- 审计日志不可篡改
- 审计日志保留180天
- 支持按资源、操作人、时间查询

---

### 需求10：可用性要求

**REQ-NFR-011**: 系统可用性  
**优先级**: MUST  
THE System SHALL 系统可用性达到99.9%

**验收标准**:
- 月度可用性 ≥ 99.9%
- 计划内维护不计入停机时间
- 提供健康检查接口

**REQ-NFR-012**: 数据一致性  
**优先级**: MUST  
THE System SHALL 使用乐观锁保证数据一致性

**验收标准**:
- 使用version字段实现乐观锁
- 并发冲突时拒绝更新
- 提供友好的冲突提示

---

### 需求11：可维护性要求

**REQ-NFR-013**: 代码质量  
**优先级**: SHOULD  
THE System SHALL 代码测试覆盖率达到80%以上

**验收标准**:
- 单元测试覆盖率 ≥ 70%
- 集成测试覆盖核心流程
- 使用JaCoCo统计覆盖率

**REQ-NFR-014**: 日志记录  
**优先级**: MUST  
THE System SHALL 记录详细的操作日志

**验收标准**:
- 记录所有API请求和响应
- 记录异常堆栈信息
- 日志包含traceId便于追踪
- 日志按天滚动，保留30天

---

## 优先级说明

### MoSCoW优先级

| 优先级 | 说明 | 需求数量 |
|-------|------|---------|
| **MUST** | MVP必须实现 | 26个 |
| **SHOULD** | 重要但可延后 | 3个 |
| **COULD** | 可选功能 | 0个 |
| **WONT** | 本版本不实现 | 0个 |

### 优先级分布

- **功能性需求**: 26个MUST，2个SHOULD
- **非功能性需求**: 10个MUST，1个SHOULD

---

## 需求追溯矩阵

| 需求ID | 用户故事 | 验收标准 | 测试用例 | 状态 |
|-------|---------|---------|---------|------|
| REQ-FR-001 | 需求1 | ✅ | 待编写 | 已定义 |
| REQ-FR-002 | 需求1 | ✅ | 待编写 | 已定义 |
| ... | ... | ... | ... | ... |

---

## 假设验证结果

| 假设ID | 假设内容 | 验证方法 | 验证结果 | 状态 |
|-------|---------|---------|---------|------|
| AS-001 | MVP使用6种预置类型 | 用户确认 | ✅ 确认 | 已验证 |
| AS-002 | 数据模型预留扩展性 | 架构评审 | ✅ 确认 | 已验证 |
| AS-003 | 扩展属性使用JSON | 技术方案 | ✅ 确认 | 已验证 |
| AS-004 | 权限系统后续开发 | 用户确认 | ✅ 确认 | 已验证 |
| AS-005 | 搜索只支持名称 | 用户确认 | ✅ 确认 | 已验证 |
| AS-006 | 标签限制10个 | 用户测试 | 待验证 | 待验证 |
| AS-007 | 列表默认20条 | 用户测试 | 待验证 | 待验证 |
| AS-008 | 敏感字段关键词识别 | 代码审查 | 待验证 | 待验证 |

---

## 风险评估

| 风险ID | 风险描述 | 概率 | 影响 | 等级 | 缓解策略 | 状态 |
|-------|---------|------|------|------|---------|------|
| RISK-001 | 列表查询性能 | 中 | 高 | 高 | 索引优化+缓存 | 已制定 |
| RISK-002 | JSON查询性能 | 中 | 中 | 中 | 虚拟列索引 | 已制定 |
| RISK-003 | 加密性能影响 | 低 | 中 | 低 | 只加密必要字段 | 已制定 |
| RISK-004 | 乐观锁冲突频繁 | 低 | 中 | 低 | 友好提示+监控 | 已制定 |
| RISK-005 | 密钥管理复杂 | 低 | 高 | 中 | 配置文件+未来KMS | 已制定 |

---

## 附录

### A. EARS语法说明

本文档使用EARS（Easy Approach to Requirements Syntax）语法编写需求：

- **无条件**: THE System SHALL [行为]
- **事件驱动**: WHEN [事件] THEN THE System SHALL [响应]
- **条件**: IF [条件] THEN THE System SHALL [行为]
- **状态**: WHILE [状态] THE System SHALL [行为]

### B. 参考文档

- 需求澄清文档: `.kiro/specs/f03-resource-management/requirement-clarification.md`
- 原始Feature文档: `doc/1-intent/2-features/F03-创建和管理IT资源.md`
- F02-1规划文档: `doc/1-intent/2-features/F02-1-资源类型管理.md`

---

**文档版本**: v1.0  
**最后更新**: 2024-11-30  
**下一步**: 进入阶段3 - 需求验证
